"use client";

import { TreePine } from "lucide-react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import {
	Select,
	SelectContent,
	SelectItem,
	SelectTrigger,
	SelectValue,
} from "@/components/ui/select";
import { Textarea } from "@/components/ui/textarea";
import type { LandWizardData } from "../../land-wizard";

const LAND_TYPES = [
	{ value: "residential", label: "Residencial" },
	{ value: "commercial", label: "Comercial" },
	{ value: "agricultural", label: "Agrícola" },
	{ value: "beachfront", label: "Frente al Mar" },
];

const LAND_CHARACTERISTICS = [
	"Acceso a agua",
	"Electricidad",
	"Acceso por carretera",
	"Terreno plano",
	"Vista a montañas",
	"Vista al mar",
	"Acceso a río",
	"Área boscosa",
];

type LandGeneralStepProps = {
	data: LandWizardData;
	onChange: (data: LandWizardData) => void;
};

export function LandGeneralStep({
	data,
	onChange,
}: LandGeneralStepProps) {
	const handleChange = (field: keyof LandWizardData, value: string | number) => {
		onChange({ ...data, [field]: value });
	};

	return (
		<div className="space-y-6">
			<Card>
				<CardHeader>
					<CardTitle className="flex items-center gap-2">
						<TreePine className="h-5 w-5" />
						Información General del Terreno
					</CardTitle>
				</CardHeader>
				<CardContent className="space-y-4">
					{/* Name */}
					<div className="space-y-2">
						<div className="flex items-center justify-between">
							<Label htmlFor="name">Nombre del Terreno *</Label>
							<Button
								disabled={!watchedValues.landType || generateAI.isPending}
								onClick={handleGenerateTitle}
								size="sm"
								type="button"
								variant="outline"
							>
								<Sparkles className="mr-2 h-4 w-4" />
								{generateAI.isPending ? "Generando..." : "Generar con IA"}
							</Button>
						</div>
						<Input
							id="name"
							{...register("name")}
							className={cn(formErrors.name && "border-destructive")}
							placeholder="Ej: Terreno en Punta Cana"
						/>
						{formErrors.name && (
							<p className="text-destructive text-sm">
								{formErrors.name.message}
							</p>
						)}
					</div>

					{/* Land Type */}
					<div className="space-y-2">
						<Label>Tipo de Terreno *</Label>
						<Select
							onValueChange={(value) =>
								setValue(
									"landType",
									value as
										| "residential"
										| "commercial"
										| "agricultural"
										| "beachfront"
								)
							}
							value={watchedValues.landType || ""}
						>
							<SelectTrigger
								className={cn(formErrors.landType && "border-destructive")}
							>
								<SelectValue placeholder="Selecciona el tipo" />
							</SelectTrigger>
							<SelectContent>
								{LAND_TYPES.map((type) => (
									<SelectItem key={type.value} value={type.value}>
										{type.label}
									</SelectItem>
								))}
							</SelectContent>
						</Select>
						{formErrors.landType && (
							<p className="text-destructive text-sm">
								{formErrors.landType.message}
							</p>
						)}
					</div>

					{/* Price and Surface */}
					<div className="grid grid-cols-1 gap-4 xl:grid-cols-2">
						<div className="space-y-2">
							<Label htmlFor="price">Precio (USD) *</Label>
							<div className="relative">
								<DollarSign className="-translate-y-1/2 absolute top-1/2 left-3 h-4 w-4 text-muted-foreground" />
								<Input
									id="price"
									type="number"
									{...register("price", { valueAsNumber: true })}
									className={cn(
										"pl-10",
										formErrors.price && "border-destructive"
									)}
									min="0"
									placeholder="0"
								/>
							</div>
							{formErrors.price && (
								<p className="text-destructive text-sm">
									{formErrors.price.message}
								</p>
							)}
						</div>

						<div className="space-y-2">
							<Label htmlFor="surface">Superficie (m²) *</Label>
							<div className="relative">
								<Ruler className="-translate-y-1/2 absolute top-1/2 left-3 h-4 w-4 text-muted-foreground" />
								<Input
									id="surface"
									type="number"
									{...register("surface", { valueAsNumber: true })}
									className={cn(
										"pl-10",
										formErrors.surface && "border-destructive"
									)}
									min="0"
									placeholder="0"
								/>
							</div>
							{formErrors.surface && (
								<p className="text-destructive text-sm">
									{formErrors.surface.message}
								</p>
							)}
						</div>
					</div>

					{/* Characteristics */}
					<div className="space-y-2">
						<Label>Características del Terreno</Label>
						<div className="grid grid-cols-2 gap-2 xl:grid-cols-3">
							{LAND_CHARACTERISTICS.map((characteristic) => {
								const isSelected =
									selectedCharacteristics.includes(characteristic);
								return (
									<Button
										key={characteristic}
										onClick={() => handleCharacteristicToggle(characteristic)}
										size="sm"
										type="button"
										variant={isSelected ? "default" : "outline"}
									>
										{characteristic}
									</Button>
								);
							})}
						</div>
					</div>

					{/* Description */}
					<div className="space-y-2">
						<div className="flex items-center justify-between">
							<Label htmlFor="description">Descripción *</Label>
							<Button
								disabled={!watchedValues.landType || generateAI.isPending}
								onClick={handleGenerateDescription}
								size="sm"
								type="button"
								variant="outline"
							>
								<Sparkles className="mr-2 h-4 w-4" />
								{generateAI.isPending ? "Generando..." : "Generar con IA"}
							</Button>
						</div>
						<Textarea
							id="description"
							{...register("description")}
							className={cn(formErrors.description && "border-destructive")}
							placeholder="Describe las características principales del terreno..."
							rows={4}
						/>
						{formErrors.description && (
							<p className="text-destructive text-sm">
								{formErrors.description.message}
							</p>
						)}
					</div>
				</CardContent>
			</Card>
		</div>
	);
}
